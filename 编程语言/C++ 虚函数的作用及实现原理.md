## C++ 虚函数的作用及实现原理

### 虚函数的作用

那些被 virtual 关键字修饰的成员函数，就是虚函数。虚函数的作用，用专业术语来解释就是实现多态性（Polymorphism）。

什么是多态，多态就是用父类型别的指针指向其子类的实例，然后通过父类的指针调用实际子类的成员函数。在运行时决定的。

### 虚函数的实现原理

虚函数（Virtual Function）是通过一张虚函数表（Virtual Table）来实现的。简称为V-Table。

vptr(指向虚函数表的指针)：C++ 的编译器保证虚函数表的指针存在于对象实例中最前面的位置（这是为了保证取到虚函数表的有最高的性能——如果有多层继承或是多重继承的情况下）。

vtable(虚函数表)：存储一个类的虚函数的地址的表，这张表解决了继承、覆盖的问题，保证其容真实反应实际的函数。

原理：通过对象实例的地址(vptr)得到这张虚函数表，然后就可以遍历其中函数指针，并调用相应的函数。

每个类只有一份虚函数表，所有该类的对象共用同一张虚函数表，所以同一个类的不同对象的虚函数指针的地址是相同的。

## 虚函数与纯虚函数的区别

一个类中有纯虚函数，表示这个类为抽象类，不能实例化对象。

纯虚函数的实现必须由子类来完成。

当一个类只有纯虚函数，表示这个类为接口类。

纯虚函数最显著的特征是：它们必须在继承类中重新声明函数（不要后面的＝0，否则该派生类也不能实例化），而且它们在抽象类中往往没有定义。

## 参考

* [C++ 虚函数表解析](https://coolshell.cn/articles/12165.html)
* [C++ 对象的内存布局](https://coolshell.cn/articles/12176.html)
* [虚函数和纯虚函数的区别](http://blog.csdn.net/hackbuteer1/article/details/7558868)
