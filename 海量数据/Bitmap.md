# Bitmap 位图算法

Bitmap 可以理解为通过一个 bit 数组来存储特定数据的一种数据结构；由于 bit 是数据的最小单位，所以这种数据结构往往是非常节省存储空间。

用于对大量整型数据做去重和查询。

### 什么是 Bitmap 算法

Bitmap 是利用 bit 数组来标记某个元素对应的 Value(存在为1)，而 Key 即是该元素。

### 核心原理

用 1个bit 来表示一个数据是否存在，存在，bit 位标记为 1。

### 优缺点

优点：

* 运算效率高，不许进行比较和移位
* 占用内存少，比如 N=10000000；只需占用内存为 N/8=1250000Byte=1.25M

缺点：

* 所有的数据不能重复。即不可对重复的数据进行排序和查找

## RoaringBitmap

数据范围比较大的数据,采用bitmap会造成浪费,比如只有一个数100000000,无论对于空间,还是进行集合操作的时间,都很浪费,对于这种情况,采用RoaringBitmap进行改进

RoaringBitmap针对部分稠密,整体稀疏的数据进行了优化

其实就是双层map结构

思路(32位整数):
- 使用数据的高16位作为第一层索引,只有高16位存在的建立第二层容器,否则不分配空间
- 第二层结构不确定
  - 默认结构ArrayContainer,有序数组,对于稀疏而没有规律的数据效率较高
  - BitmapContainer,普通bitmap,当数据量超过4096自动转换,ArrayContainer(4096*16b)不比采用普通bitmap(65536*1b)省地方了,而bitmap查找更快
  - RunContainer,采用rle编码存储数据,例如(1,2,3,4,...100)转为[1,100],不会自动转换,调用runOptimize进行转换,对于连续度高的数据好用