# 待修正

更严谨的描述栈的实现方式（例如x86上的esp/rsp寄存器），堆的实现（sbrk，malloc，free，jemalloc）

## Linux 进程的内存空间分布

一个可执行程序在存储（没有调入内存）时分为 代码段，数据段，未初始化数据段(BSS)三部分：

### 1. 代码段

存放 CPU 执行的机器指令。通常代码区是共享的，即其它执行程序可调用它。假如机器中有数个进程运行相同的一个程序，那么它们就可以使用同一个代码段。

### 2. 数据段

存放已初始化的全局变量，静态变量（包括全局和局部的），常量。

static 全局变量和 static 函数只能在当前文件中被调用。

### 3. BSS(未初始化数据段)

存放全局未初始化的变量。

BSS 的数据在程序开始执行之前被初始化为 0 或 NULL。

> **可执行程序在运行时又多出了两个区域：栈段（Stack）和堆段(Heap)。**

### 4. 堆

用于存放进程运行中被动态分配的内存段，位于 BSS 和栈中间的地址位。

由程序员申请分配（malloc)和释放（free）。堆是从低地址位向高地址位增长，采用链式存储结构。

频繁地 malloc/free 造成内存空间的不连续，产生碎片。当申请堆空间时库函数按照一定的算法搜索可用的足够大的空间。因此堆的效率比栈要低的多。

### 5. 栈

由编译器自动释放，存放函数的参数值，局部变量等。每当一个函数被调用时，该函数的返回类型和一些调用的信息(返回地址等)被存储到栈中。

然后这个被调用的函数再为它的自动变量和临时变量在栈上分配空间。

栈区是从高地址位向低地址位增长的，是一块连续的内在区域，最大容量是由系统预先定义好的，申请的栈空间超过这个界限时会提示溢出，用户能从栈中获取的空间较小。

`ulimit -s xx` ：修改栈的大小

`ulimit -s` ：显示栈大小的限制

## 总结

代码区所在的地址空间最低，往上依次是 数据区 和 BSS 区、堆、栈。

数据区、BSS 区、堆在内存中连续存储。

代码区和栈区在内存中是独立存放的。

堆和栈的区别：

* 申请方式不同
* 申请后系统的响应不同
* 申请大小的限制不同
* 申请效率不同
* 堆和栈中的存储内容不同

## 参考

* http://www.cnblogs.com/daocaoren/archive/2011/06/29/2092957.html
* http://blog.csdn.net/hguisu/article/details/6152921
