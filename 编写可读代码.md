# 编写可读代码
目的是使理解所需时间最小化,这样的代码,易于理解,而且由于逻辑上本质的简单性,易于修改,易于测试,且具有优良的架构属性

根本原则:最小化理解所需时间
```java
//hash = (65599 * hash) + c
hash = (hash << 6) + (hash << 16) - hash + c
```
这个注释就简化了理解

## 表面改进

### 富含信息的名字

- 选择专业词汇(准确,简洁)
  - 下载网页 fetchPage优于getPage,强调了使用网络
  - Thread.kill() pause() 比stop好,强调了是否可以继续执行该线程
- 尽可能不要用tmp,retval这种变量名,尽可能使用其意义作为变量名,除非它本来就是个作用域很小的临时值
- 迭代器名字使用i,j,k,容易使人忘记它对应的是哪个容器的下标,例如容器clubs
  - 在迭代器名字前面加上容器名首字母作为区分,i -> ci
  - i -> clubs_i
- 使用具体的名字代替抽象的名字,描述手段而不描述目的,适用于隐晦的宏和命令行参数
- 变量名带上更多内容相关的,不能从类型看出来的信息
  - 字符串,带上格式,例如十六进制表示的id,id->hex_id
  - 数值,带上单位,例如delay->delay_ms
  - 字节数组,带上编码,html -> html_utf8
  - 安全相关信息,password -> unencrypted_password
- 采用长短合适的名字
  - 小作用域中,上下文已经带来了很多信息,变量名无需太详细,反之需要长变量名
  - 使用惯用的缩略词,其他词不要缩略
  - 丢掉无用词,convertToString -> toString
  - 采用某种固定的命名规范,比如google规范
  - 采用编程语言推荐的最佳实践命名规范

### 不易误解的名字

filter(条件) -> 是要找符合条件的还是滤去不符合条件的?改为select(条件)

first last,min max表示闭区间,表示 第一个到第十个 这种句子比较方便

begin end表示左闭右开区间,表示 从五点到十二点 这种句子比较方便

用is,has,should等表明返回bool值


遵循惯例,比如get...(),getter,一般被认为是轻量级的,O(1)的内存操作,不访问网络和数据库,反例std::list::size是一个O(n)操作,应改为countElements,即加入一个能表明其代价的动词


### 审美

一样的东西,放到近似的地方,不同的东西,采用统一的顺序,也就是所谓的整齐,给人一种表格的感觉

声明,按照其功能作用类型分块

实现,按照合适的粒度划分成小块(易于理解即可)

团队内部统一风格

### 注释
注释的目的:写出没有体现在代码中的,只有你在写代码时才知道的上下文

人类语言说着简单,而复杂的实现

给类/函数起个好名字有时可以免去注释

特别注释
- 记下实现采用的算法的理由,以及当时对其他算法的考量,防止后人盲目优化
- 记录一些权衡,可能为了性能牺牲了准确性等,防止后人认为这是个bug
- TODO:要做却还没有做的事
- FIXME:不能用的代码,防止踩坑
- HACK:暂时的黑科技解决方案,不可维护,以后可能要改
- XXX:危险
- 给常量加注释:看代码的人不知道的,设置这个常量为特定值的理由

站在读者角度
- 读者可能的问题
- 可能坑到读者的陷阱
- 文件级别的,包级别的全局观注释

写注释步骤
* 写下心里所想的
* 改为精简且准确的表达
* 再进行别的想的到的改进

### 简化注释
提高信息含量

- 有时类似程序语言的语法信息含量优于人类语言
  - ```c++
    // CategoryType -> (score, weight)
    typedef hash_map<int, pair<float,float>> ScoreMap;
    ```
- 避免代词,代词在上下文中易引发歧义
- 使用典型输入输出例子描述函数行为
- 描述复杂的代码块时描述目的而非细节




## 简化逻辑

### 控制流
- 比较表达式,例如age>5,人类的习惯是左边是变量,右边是常量
- 多条件分支时
  - 先处理正逻辑
  - 先处理简单情况
  - 先处理有趣,可疑的情况
  - 如果上面三条冲突,怎么舒服怎么来,尽可能使分支点在视野之内
- 避免do while,因为条件放在后面,不自然
- 尽可能减少嵌套,善用return,break,continue
- 多线程,信号,中断,异常,函数指针,虚函数,使得运行流难以追踪,不必要时不要用

### 表达式

用中间变量拆分超长表达式,使人明白中间结果的含义

### 变量

- 减少不能改进可读性的变量
- 缩小作用域
- 善用常量

# 重新组织代码

## 抽取不相关子问题 (代码的位置)
不相关的子问题,使得程序员无法集中在一个抽象层面上,于是抽取不相关子问题

- 作用域很小,使用变量很少的复杂运算代码
- 最基础的,业务无关的工具类
- 用于调试的,美化输出的等等业务无关,也不算通用工具的部分
- 数据格式转换,接口转换adapter

把一般代码和项目专有的代码分开

## 一次只做一件事 (代码的顺序)
一个函数里,做多件事的逻辑交织,难以追踪,难以理解,整理成为分离的代码块,甚至独立的函数

## 想法->代码

- 先用人类语言描述,再翻译为代码 (人类语言更好的划分了抽象层次)
- 多了解标准库,第三方库

## 少写代码
最好读的代码就是没有代码

- 更精确的定位自己的代码解决的问题,不要试图包罗万象,采用较简单的解决方案
- 防止代码库膨胀,定期修剪,使其易于修改,易于进化

# 周边话题

## 测试代码

- 测试数据的创建总是遵循套路,可以封装起来
- 用自然语言描述测试内容,据此创建最小化的测试接口
- 使错误输出包含更多信息(输入,预期输出,实际输出)
- 选用简单(不夸张)而有代表性(包罗万象)的测试输入
- 使用多个测试来测试一个函数的多个主要分支,而不是建立一个"完美"的输入跑遍所有分支
- 测试函数由于都是单独调用,名字贼长没关系,尽可能详细(类,函数,测试场景)
- 测试驱动开发,先写测试代码,后写业务
- 不要着迷于100%测试覆盖,90%即可,再多不值得